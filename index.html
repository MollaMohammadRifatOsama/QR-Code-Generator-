<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>QR Generator with Transparent</title>

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#e9ecef;
  --card:#ffffff;
  --primary:#007bff;
  --success:#28a745;
  --danger:#dc3545;
  --border:#ced4da;
  --shadow:0 10px 30px rgba(0,0,0,.12);
  --radius:14px;
}
*{ box-sizing:border-box; }

body{
  font-family:'Roboto',sans-serif;
  margin:0;
  background:var(--bg);
  display:flex;
  align-items:center;
  justify-content:center;
  padding:18px;
}

.container{
  width:100%;
  max-width:480px;
  background:var(--card);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:22px;
  text-align:center;
}

.field{ text-align:left; margin-top:12px; }
input[type="text"], select{
  width:100%;
  padding:12px;
  border:1px solid var(--border);
  border-radius:10px;
  font-size:15px;
}

.btnrow{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin-top:14px;
}

button{
  flex:1;
  padding:12px;
  border:0;
  border-radius:10px;
  cursor:pointer;
  font-weight:bold;
}

.btn-primary{ background:var(--primary); color:#fff; }
.btn-success{ background:var(--success); color:#fff; }
.btn-ghost{ background:#f1f3f5; }

button:disabled{ opacity:.5; cursor:not-allowed; }

.error{
  display:none;
  margin-top:10px;
  padding:10px;
  border-radius:8px;
  background:rgba(220,53,69,.1);
  color:var(--danger);
  font-size:13px;
}

#qrWrap{
  margin-top:20px;
  width:100%;
  min-height:300px;
  position:relative;
  display:flex;
  justify-content:center;
  align-items:center;
  border:1px dashed #ccc;
}

canvas{
  background:#fff;
  border:3px solid var(--primary);
  border-radius:12px;
}
</style>
</head>

<body>
<div class="container">

<div class="field">
<input id="inputText" type="text" placeholder="Text / Link" />
<div id="errorBox" class="error"></div>
</div>

<div class="field">
<select id="sizeSel">
<option value="200">200px</option>
<option value="250" selected>250px</option>
<option value="300">300px</option>
<option value="350">350px</option>
<option value="400">400px</option>
</select>
</div>

<div class="btnrow">
<button id="generateBtn" class="btn-primary">Generate</button>
<button id="clearBtn" class="btn-ghost">Clear</button>
</div>

<div class="btnrow">
<button id="downloadPngBtn" class="btn-success" disabled>PNG</button>
<button id="downloadJpgBtn" class="btn-success" disabled>JPG</button>
<button id="downloadTransBtn" class="btn-success" disabled>Transparent PNG</button>
</div>

<div id="qrWrap">
<canvas id="qrCanvas"></canvas>
</div>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.0/qrious.min.js"></script>
<script>
const inputEl = document.getElementById('inputText');
const sizeSel = document.getElementById('sizeSel');
const qrCanvas = document.getElementById('qrCanvas');
const generateBtn = document.getElementById('generateBtn');
const clearBtn = document.getElementById('clearBtn');
const downloadPngBtn = document.getElementById('downloadPngBtn');
const downloadJpgBtn = document.getElementById('downloadJpgBtn');
const downloadTransBtn = document.getElementById('downloadTransBtn');
const errorBox = document.getElementById('errorBox');

let qr = null;

function showError(msg){
  errorBox.textContent = msg;
  errorBox.style.display = "block";
}
function hideError(){
  errorBox.style.display = "none";
}
function enableDownloads(v){
  downloadPngBtn.disabled = !v;
  downloadJpgBtn.disabled = !v;
  downloadTransBtn.disabled = !v;
}

// Generate QR
function generateQR(){
  const value = inputEl.value.trim();
  const size = parseInt(sizeSel.value) || 250;

  if(!value){
    showError("Text/Link দিন");
    return;
  }
  hideError();

  const ctx = qrCanvas.getContext("2d");
  ctx.clearRect(0,0,qrCanvas.width,qrCanvas.height);

  const scale = window.devicePixelRatio || 1;
  qrCanvas.width = size * scale;
  qrCanvas.height = size * scale;
  qrCanvas.style.width = size + "px";
  qrCanvas.style.height = size + "px";
  ctx.setTransform(scale,0,0,scale,0,0);

  qr = new QRious({
    element: qrCanvas,
    size: size,
    value: value,
    level: 'H',
    background: '#fff',
    foreground: '#007bff'
  });

  enableDownloads(true);
}

// Auto-generate default QR
window.addEventListener('load', () => {
  inputEl.value = "https://example.com";
  generateQR();
});

generateBtn.onclick = generateQR;

clearBtn.onclick = () => {
  inputEl.value = "";
  qrCanvas.getContext("2d").clearRect(0,0,qrCanvas.width,qrCanvas.height);
  enableDownloads(false);
};

// PNG Download
downloadPngBtn.onclick = () => {
  const a = document.createElement("a");
  a.href = qrCanvas.toDataURL("image/png");
  a.download = "qr.png";
  a.click();
};

// JPG Download
downloadJpgBtn.onclick = () => {
  const a = document.createElement("a");
  a.href = qrCanvas.toDataURL("image/jpeg",0.95);
  a.download = "qr.jpg";
  a.click();
};

// Transparent PNG Download
downloadTransBtn.onclick = () => {
  const w = qrCanvas.width, h = qrCanvas.height;
  const srcCtx = qrCanvas.getContext("2d");
  const img = srcCtx.getImageData(0,0,w,h);
  const off = document.createElement("canvas");
  off.width = w; off.height = h;
  const offCtx = off.getContext("2d");
  const d = img.data;
  for(let i=0;i<d.length;i+=4){
    const r=d[i], g=d[i+1], b=d[i+2];
    if(r>245 && g>245 && b>245){ d[i+3]=0; } // White -> transparent
  }
  offCtx.putImageData(img,0,0);
  const a = document.createElement("a");
  a.href = off.toDataURL("image/png");
  a.download = "qr_transparent.png";
  a.click();
};
</script>
</body>
</html>
